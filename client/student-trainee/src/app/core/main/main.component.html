<div class="flex px-20 bg-gray-100 h-full">
  <div class="flex flex-col flex-1">
    <app-header></app-header>
    <!-- Header Extras: Clock + Logout -->
    <div
      class="flex justify-end items-center gap-6 p-4 bg-white border-b border-gray-200"
    >
      <!-- Real-time Clock -->
      <div class="text-sm text-gray-600 poppins-medium">
        {{ dateTime }}
      </div>

      <!-- Logout Button -->
      <button
        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 text-sm poppins-medium rounded"
        (click)="logout()"
      >
        Logout
      </button>
    </div>

    <div class="flex-1 bg-white p-4">
      <div class="border-b border-gray-200 mb-4">
        <nav class="flex gap-4">
          <button
            (click)="activeTab = 0"
            [class.border-b-2]="activeTab === 0"
            [class.border-green-500]="activeTab === 0"
            [class.text-green-600]="activeTab === 0"
            class="px-4 py-2 text-sm poppins-medium hover:text-green-600 transition-colors"
          >
            Profile
          </button>
          <button
            (click)="activeTab = 1"
            [class.border-b-2]="activeTab === 1"
            [class.border-green-500]="activeTab === 1"
            [class.text-green-600]="activeTab === 1"
            class="px-4 py-2 text-sm poppins-medium hover:text-green-600 transition-colors"
          >
            Internships
          </button>
          <button
            (click)="activeTab = 2"
            [class.border-b-2]="activeTab === 2"
            [class.border-green-500]="activeTab === 2"
            [class.text-green-600]="activeTab === 2"
            class="px-4 py-2 text-sm poppins-medium hover:text-green-600 transition-colors"
          >
            My Applications
          </button>
          <button
            (click)="activeTab = 3"
            [class.border-b-2]="activeTab === 3"
            [class.border-green-500]="activeTab === 3"
            [class.text-green-600]="activeTab === 3"
            class="px-4 py-2 text-sm poppins-medium hover:text-green-600 transition-colors"
          >
            Requirements
          </button>
          <button
            (click)="activeTab = 4"
            [class.border-b-2]="activeTab === 4"
            [class.border-green-500]="activeTab === 4"
            [class.text-green-600]="activeTab === 4"
            class="px-4 py-2 text-sm poppins-medium hover:text-green-600 transition-colors"
          >
            OJT Tracker
          </button>
          <button
            (click)="activeTab = 5"
            [class.border-b-2]="activeTab === 5"
            [class.border-green-500]="activeTab === 5"
            [class.text-green-600]="activeTab === 5"
            class="px-4 py-2 text-sm poppins-medium hover:text-green-600 transition-colors"
          >
            OEAMS
          </button>
        </nav>
      </div>

      <div [hidden]="activeTab !== 0">
        <!-- Unified Profile + Requirements Container -->
        <div
          class="bg-white border border-gray-200 rounded-lg m-6 p-6 grid grid-cols-1 md:grid-cols-3 gap-6 poppins-regular"
        >
          <!-- Left Column: Profile Image + Edit Button -->
          <div class="flex flex-col items-center gap-4">
            <img
              [src]="profileData?.profile_picture || 'assets/img/default-avatar.jpg'"
              alt="Profile Image"
              class="w-36 h-36 rounded-full object-cover ring-2 ring-green-400 ring-offset-2 transition hover:grayscale"
            />
            <button
              (click)="openEditProfile()"
              class="flex items-center gap-2 px-4 py-2 text-white bg-green-500 hover:bg-green-600 rounded-md text-sm poppins-medium transition"
              title="Edit your profile"
            >
              <i class="pi pi-pencil text-sm"></i>
              Edit Profile
            </button>
            <button
              (click)="downloadPersonalHistoryStatement()"
              class="flex items-center gap-2 px-4 py-2 text-white bg-blue-500 hover:bg-blue-600 rounded-md text-sm poppins-medium transition"
              title="Download Personal History Statement"
            >
              <i class="pi pi-download text-sm"></i>
              Download PHS
            </button>
          </div>

          <!-- Right Column: Profile Information + Requirements -->
          <div class="md:col-span-2 space-y-6">
            <!-- Profile Info -->
            <div *ngIf="isLoadingProfile" class="text-center py-8">
              <p class="text-gray-500">Loading profile...</p>
            </div>

            <div *ngIf="!isLoadingProfile && profileData">
              <h2
                class="text-xl mb-4 poppins-medium text-gray-800 border-l-4 pl-3 border-green-500"
              >
                {{ profileData.first_name }} {{ profileData.middle_name }}
                {{ profileData.last_name }}
              </h2>

              <div class="mb-4">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  SR-Code
                </p>
                <p class="text-sm text-gray-800">
                  {{ profileData.sr_code || "Not set" }}
                </p>
              </div>

              <hr class="my-3" />

              <div
                class="mb-4"
                *ngIf="profileData.program || profileData.year_level"
              >
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Program
                </p>
                <p class="text-sm text-gray-700">
                  {{ profileData.program || "Not set" }}
                  <span *ngIf="profileData.year_level">
                    - {{ profileData.year_level }}</span
                  >
                </p>
              </div>

              <hr
                class="my-3"
                *ngIf="profileData.program || profileData.year_level"
              />

              <div class="mb-4" *ngIf="profileData.department">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Department
                </p>
                <p class="text-sm text-gray-700">
                  {{ profileData.department }}
                </p>
              </div>

              <hr class="my-3" *ngIf="profileData.department" />

              <div
                class="mb-4"
                *ngIf="profileData.skills && profileData.skills.length > 0"
              >
                <p
                  class="uppercase tracking-wide text-[10px] text-gray-500 mb-2"
                >
                  Skills
                </p>
                <div class="flex flex-wrap gap-2">
                  <span
                    *ngFor="let skill of profileData.skills"
                    class="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium"
                  >
                    {{ skill.skill_name }}
                  </span>
                </div>
              </div>

              <div
                class="mb-4"
                *ngIf="!profileData.skills || profileData.skills.length === 0"
              >
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Skills
                </p>
                <p class="text-sm text-gray-500 italic">No skills added yet</p>
              </div>

              <hr class="my-3" />

              <div class="mb-4" *ngIf="profileData.about">
                <p
                  class="uppercase tracking-wide text-[10px] text-gray-500 mb-2"
                >
                  About Me
                </p>
                <p class="text-sm text-gray-700 leading-relaxed">
                  {{ profileData.about }}
                </p>
              </div>

              <div class="mb-4" *ngIf="!profileData.about">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  About Me
                </p>
                <p class="text-sm text-gray-500 italic">No bio added yet</p>
              </div>

              <hr class="my-3" />

              <div *ngIf="profileData.email">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Email
                </p>
                <p class="text-sm text-gray-700">{{ profileData.email }}</p>
              </div>

              <hr class="my-3" *ngIf="profileData.contact_number || profileData.tel_no_present" />

              <div class="mb-4" *ngIf="profileData.contact_number">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Mobile Number
                </p>
                <p class="text-sm text-gray-700">{{ profileData.contact_number }}</p>
              </div>

              <div class="mb-4" *ngIf="profileData.tel_no_present">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Telephone (Present)
                </p>
                <p class="text-sm text-gray-700">{{ profileData.tel_no_present }}</p>
              </div>

              <div class="mb-4" *ngIf="profileData.present_address">
                <p class="uppercase tracking-wide text-[10px] text-gray-500">
                  Address
                </p>
                <p class="text-sm text-gray-700">{{ profileData.present_address }}</p>
              </div>

              <hr class="my-3" *ngIf="profileData.birthdate || profileData.age || profileData.sex" />

              <div class="grid grid-cols-3 gap-4 mb-4" *ngIf="profileData.birthdate || profileData.age || profileData.sex">
                <div *ngIf="profileData.birthdate">
                  <p class="uppercase tracking-wide text-[10px] text-gray-500">Birthdate</p>
                  <p class="text-sm text-gray-700">{{ profileData.birthdate }}</p>
                </div>
                <div *ngIf="profileData.age">
                  <p class="uppercase tracking-wide text-[10px] text-gray-500">Age</p>
                  <p class="text-sm text-gray-700">{{ profileData.age }}</p>
                </div>
                <div *ngIf="profileData.sex">
                  <p class="uppercase tracking-wide text-[10px] text-gray-500">Gender</p>
                  <p class="text-sm text-gray-700">{{ profileData.sex }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div [hidden]="activeTab !== 1">
        <app-internships></app-internships>
      </div>

      <div [hidden]="activeTab !== 2">
        <div class="p-6 bg-white poppins-regular">
          <h2
            class="text-lg poppins-medium mb-4 text-gray-800 border-b border-gray-300 pb-2"
          >
            My Internship Applications
          </h2>

          <!-- Loading State -->
          <div *ngIf="isLoadingApplications" class="text-center py-8">
            <p class="text-gray-500">Loading your applications...</p>
          </div>

          <!-- Content when loaded -->
          <div *ngIf="!isLoadingApplications">
            <!-- ðŸ” Search Bar -->
            <div class="mb-4 flex items-center justify-between">
              <input
                type="text"
                [(ngModel)]="searchText"
                placeholder="Search by company, position, or status..."
                class="border text-sm py-2 px-3 w-80 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded"
              />
              <button
                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 text-sm poppins-medium rounded"
                (click)="loadApplications()"
              >
                <i class="pi pi-refresh"></i> Refresh
              </button>
            </div>

            <!-- Empty State -->
            <div *ngIf="appliedJobs.length === 0" class="text-center py-12">
              <i class="pi pi-inbox text-6xl text-gray-300 mb-4"></i>
              <p class="text-gray-500 text-lg">No applications yet</p>
              <p class="text-gray-400 text-sm">
                Start applying to internships to see them here
              </p>
            </div>

            <!-- ðŸ“‹ Application Table -->
            <p-table
              *ngIf="appliedJobs.length > 0"
              #table
              [value]="appliedJobs"
              class="p-datatable-sm w-full"
              [globalFilterFields]="['companyName', 'position', 'status']"
            >
              <ng-template pTemplate="header">
                <tr class="bg-gray-100 text-sm text-gray-600 uppercase">
                  <th>Company</th>
                  <th>Position</th>
                  <th>Date Applied</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-job>
                <tr class="text-sm">
                  <td>{{ job.companyName }}</td>
                  <td>{{ job.position }}</td>
                  <td>{{ job.dateApplied | date : "MMM dd, yyyy" }}</td>
                  <td>
                    <span
                      class="px-2 py-1 text-sm rounded-full text-white"
                      [ngClass]="{
                        'bg-yellow-500':
                          job.status === 'Pending' || job.status === 'Reviewed',
                        'bg-green-500': job.status === 'Accepted',
                        'bg-red-500': job.status === 'Rejected'
                      }"
                    >
                      {{ job.status }}
                    </span>
                  </td>
                  <td>
                    <button
                      class="px-3 py-1 text-sm rounded text-white transition disabled:opacity-50 disabled:cursor-not-allowed"
                      [ngClass]="
                        job.status === 'Pending'
                          ? 'bg-green-500 hover:bg-green-600'
                          : 'bg-gray-400'
                      "
                      (click)="cancelApplication(job.id)"
                      [disabled]="job.status !== 'Pending'"
                    >
                      <i class="pi pi-times mr-1"></i>
                      {{
                        job.status === "Pending"
                          ? "Withdraw"
                          : "Cannot Withdraw"
                      }}
                    </button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>

      <div [hidden]="activeTab !== 3">
        <app-requirements></app-requirements>
      </div>

      <div [hidden]="activeTab !== 4">
        <app-ojt-tracker></app-ojt-tracker>
      </div>

      <div [hidden]="activeTab !== 6">
        <div class="flex h-screen bg-gray-100 text-sm font-sans">
          <!-- Sidebar Filters -->
          <aside
            class="w-80 bg-white p-6 border-r border-gray-300 poppins-regular"
          >
            <h2 class="text-2xl text-green-500 mb-4 poppins-bold">
              Job Listing
            </h2>
            <hr class="mb-6 border-black" />

            <!-- Search -->
            <div class="mb-6">
              <input
                type="text"
                placeholder="Search by keywords"
                class="w-full px-3 py-2 border border-gray-300 shadow-sm"
              />
            </div>

            <!-- Industry Filter -->
            <div class="mb-6">
              <p class="text-gray-800 mb-2 poppins-medium">
                Filter by Industry
              </p>
              <div class="space-y-2">
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  IT Software and Services
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  Academe
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  Human Resources
                </label>
              </div>
            </div>

            <!-- Company Filter -->
            <div class="mb-6">
              <p class="text-gray-800 mb-2 poppins-medium">Filter by Company</p>
              <div class="space-y-2">
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  BatStateU - Lipa
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  BatStateU - Alangilan
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  BatStateU - Nasugbu
                </label>
              </div>
            </div>

            <!-- Position Filter -->
            <div>
              <p class="text-gray-800 mb-2 poppins-medium">
                Filter by Position
              </p>
              <div class="space-y-2">
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  Fullstack Developer
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" />
                  Frontend Developer
                </label>
              </div>
            </div>
          </aside>

          <!-- Job Listings -->
          <main class="flex-1 overflow-y-auto p-6 space-y-6 poppins-regular">
            <div
              *ngFor="let job of jobs"
              class="bg-white p-6 border border-gray-300 flex gap-4 items-start shadow-sm"
            >
              <div class="w-32 h-32 bg-gray-200 flex-shrink-0"></div>
              <div class="flex-1">
                <h3 class="text-xl text-green-500 mb-1 poppins-bold">
                  {{ job.title }}
                </h3>
                <p class="text-gray-800 mb-2 poppins-medium">
                  {{ job.company }}
                </p>
                <p class="text-gray-600 mb-2 leading-relaxed">
                  {{ job.description }}
                </p>
                <p class="text-xs text-gray-500 mb-3">
                  Status:
                  <span class="text-green-600">{{ job.status }}</span>
                </p>
                <div class="flex gap-4">
                  <button class="text-green-500 underline poppins-medium">
                    View Details
                  </button>
                  <button
                    class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white poppins-medium"
                  >
                    Apply
                  </button>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>

      <div [hidden]="activeTab !== 5">
        <app-oeams></app-oeams>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div
      *ngIf="showEditDialog"
      class="fixed inset-0 z-50 flex items-center justify-center"
      (click)="closeEditProfile()"
    >
      <div
        class="bg-white rounded-lg shadow-xl w-[90vw] max-w-[1200px] max-h-[90vh] overflow-y-auto"
        (click)="$event.stopPropagation()"
      >
        <div
          class="flex items-center justify-between p-4 border-b border-gray-200"
        >
          <h2 class="text-lg font-semibold text-gray-800 poppins-medium">
            Edit Profile
          </h2>
          <button
            (click)="closeEditProfile()"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="pi pi-times text-xl"></i>
          </button>
        </div>
        <div class="p-4">
          <app-profile (profileSaved)="onProfileSaved()"></app-profile>
        </div>
      </div>
    </div>
  </div>
</div>
